<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Construction Estimator Pro</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables */
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --success: #10b981;
      --danger: #ef4444;
      --warning: #f59e0b;
      --bg: #ffffff;
      --bg-secondary: #f9fafb;
      --bg-tertiary: #f3f4f6;
      --text: #111827;
      --text-secondary: #6b7280;
      --border: #e5e7eb;
      --shadow: rgba(0, 0, 0, 0.1);
      --radius: 0.5rem;
    }

    [data-theme="dark"] {
      --bg: #111827;
      --bg-secondary: #1f2937;
      --bg-tertiary: #374151;
      --text: #f9fafb;
      --text-secondary: #d1d5db;
      --border: #4b5563;
      --shadow: rgba(0, 0, 0, 0.3);
    }

    /* Reset & Base */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-secondary);
      color: var(--text);
      line-height: 1.6;
      transition: all 0.3s ease;
    }

    /* Layout */
    .app-container {
      display: flex;
      height: 100vh;
      overflow: hidden;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg);
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border);
    }

    .sidebar-header h1 {
      font-size: 1.25rem;
      font-weight: 700;
      margin-bottom: 0.25rem;
    }

    .sidebar-header p {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .sidebar-nav {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .nav-section {
      margin-bottom: 1.5rem;
    }

    .nav-section-title {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      color: var(--text-secondary);
      margin-bottom: 0.5rem;
      padding: 0 0.5rem;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem;
      border-radius: var(--radius);
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 0.25rem;
    }

    .nav-item:hover {
      background: var(--bg-secondary);
    }

    .nav-item.active {
      background: var(--primary);
      color: white;
    }

    .nav-item-icon {
      font-size: 1.25rem;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header */
    .header {
      background: var(--bg);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Content Area */
    .content {
      flex: 1;
      padding: 2rem;
      overflow-y: auto;
    }

    /* Cards */
    .card {
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: 0 1px 3px var(--shadow);
      margin-bottom: 1.5rem;
    }

    .card-header {
      padding: 1.25rem;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-title {
      font-size: 1.125rem;
      font-weight: 600;
    }

    .card-body {
      padding: 1.25rem;
    }

    /* Form Elements */
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .form-label {
      font-size: 0.875rem;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .form-input,
    .form-select {
      padding: 0.625rem 0.875rem;
      border: 1px solid var(--border);
      border-radius: var(--radius);
      background: var(--bg);
      color: var(--text);
      font-size: 0.875rem;
      transition: all 0.2s ease;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    /* Buttons */
    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: var(--radius);
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 6px var(--shadow);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-icon {
      padding: 0.625rem;
    }

    /* Table */
    .table-wrapper {
      overflow-x: auto;
      border-radius: var(--radius);
      border: 1px solid var(--border);
    }

    .table {
      width: 100%;
      border-collapse: collapse;
    }

    .table th {
      background: var(--bg-tertiary);
      padding: 0.875rem;
      text-align: left;
      font-weight: 600;
      font-size: 0.875rem;
      color: var(--text-secondary);
      border-bottom: 1px solid var(--border);
    }

    .table td {
      padding: 0.875rem;
      border-bottom: 1px solid var(--border);
    }

    .table tr:last-child td {
      border-bottom: none;
    }

    .table tr:hover {
      background: var(--bg-secondary);
    }

    .table input,
    .table select {
      width: 100%;
      padding: 0.375rem 0.5rem;
      border: 1px solid var(--border);
      border-radius: 0.25rem;
      font-size: 0.875rem;
      background: var(--bg);
      color: var(--text);
    }

    /* Stats */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .stat-card {
      background: var(--bg);
      padding: 1.5rem;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 0.25rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    /* Quick Actions */
    .quick-actions {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
    }

    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal.active {
      opacity: 1;
      visibility: visible;
    }

    .modal-content {
      background: var(--bg);
      padding: 2rem;
      border-radius: var(--radius);
      max-width: 500px;
      width: 90%;
      transform: translateY(-20px);
      transition: transform 0.3s ease;
    }

    .modal.active .modal-content {
      transform: translateY(0);
    }

    .modal-header {
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }

    /* Toggle Switch */
    .toggle {
      position: relative;
      width: 48px;
      height: 24px;
    }

    .toggle input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: var(--border);
      transition: 0.3s;
      border-radius: 24px;
    }

    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background: white;
      transition: 0.3s;
      border-radius: 50%;
    }

    .toggle input:checked + .toggle-slider {
      background: var(--primary);
    }

    .toggle input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }

    /* Mobile Menu Toggle */
    .menu-toggle {
      display: none;
      padding: 0.5rem;
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Loading State */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--primary);
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .app-container {
        flex-direction: column;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        z-index: 999;
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .menu-toggle {
        display: block;
      }

      .header {
        padding: 1rem;
      }

      .content {
        padding: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Utilities */
    .text-success { color: var(--success); }
    .text-danger { color: var(--danger); }
    .text-warning { color: var(--warning); }
    .hidden { display: none; }
  </style>
</head>
<body data-theme="light">
  <div class="app-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <h1>Construction Estimator</h1>
        <p>Professional Edition</p>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Main</div>
          <div class="nav-item active" data-page="dashboard">
            <span class="nav-item-icon">📊</span>
            <span>Dashboard</span>
          </div>
          <div class="nav-item" data-page="estimate">
            <span class="nav-item-icon">📋</span>
            <span>Estimate</span>
          </div>
          <div class="nav-item" data-page="projects">
            <span class="nav-item-icon">📁</span>
            <span>Projects</span>
          </div>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Tools</div>
          <div class="nav-item" data-page="settings">
            <span class="nav-item-icon">⚙️</span>
            <span>Settings</span>
          </div>
          <div class="nav-item" data-page="sync">
            <span class="nav-item-icon">☁️</span>
            <span>Cloud Sync</span>
          </div>
        </div>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="header">
        <button class="menu-toggle" id="menuToggle">☰</button>
        <h2 class="header-title" id="pageTitle">Dashboard</h2>
        <div class="header-actions">
          <label class="toggle">
            <input type="checkbox" id="darkMode">
            <span class="toggle-slider"></span>
          </label>
          <button class="btn btn-primary" id="saveBtn">
            💾 Save
          </button>
        </div>
      </header>

      <!-- Content -->
      <div class="content" id="content">
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page">
          <div class="quick-actions">
            <button class="btn btn-success" onclick="switchPage('estimate')">
              ➕ New Estimate
            </button>
            <button class="btn btn-secondary" onclick="exportData()">
              📊 Export Report
            </button>
          </div>

          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalProjects">0</div>
              <div class="stat-label">Total Projects</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="totalValue">$0</div>
              <div class="stat-label">Total Value</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="avgProject">$0</div>
              <div class="stat-label">Average Project</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="activeItems">0</div>
              <div class="stat-label">Active Items</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Cost Breakdown</h3>
            </div>
            <div class="card-body">
              <canvas id="chartCanvas" style="max-height: 300px;"></canvas>
            </div>
          </div>
        </div>

        <!-- Estimate Page -->
        <div id="estimatePage" class="page hidden">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Project Details</h3>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Project Name</label>
                  <input type="text" class="form-input" id="projectName" placeholder="Enter project name">
                </div>
                <div class="form-group">
                  <label class="form-label">Region</label>
                  <select class="form-select" id="regionFactor">
                    <option value="1.00">National Average</option>
                    <option value="0.90">Southeast</option>
                    <option value="1.10">Northeast</option>
                    <option value="1.25">West Coast</option>
                  </select>
                </div>
                <div class="form-group">
                  <label class="form-label">Tax Rate (%)</label>
                  <input type="number" class="form-input" id="taxRate" value="8.25" step="0.01">
                </div>
                <div class="form-group">
                  <label class="form-label">Contingency (%)</label>
                  <input type="number" class="form-input" id="contingency" value="10" step="0.5">
                </div>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Cost Items</h3>
              <div style="display: flex; gap: 0.5rem; align-items: center;">
                <span style="font-size: 0.875rem; color: var(--text-secondary);">
                  ${Object.values(itemsDB).reduce((acc, items) => acc + items.length, 0)} items available
                </span>
                <button class="btn btn-success btn-icon" onclick="addRow()">➕</button>
              </div>
            </div>
            <div class="card-body">
              <div style="margin-bottom: 1rem;">
                <select class="form-select" id="categoryFilter" onchange="filterByCategory()" style="max-width: 250px;">
                  <option value="">All Categories</option>
                  ${Object.keys(itemsDB).map(cat => `<option value="${cat}">${cat}</option>`).join('')}
                </select>
              </div>
              <div class="table-wrapper">
                <table class="table" id="estimateTable">
                  <thead>
                    <tr>
                      <th style="width: 30%;">Item</th>
                      <th style="width: 15%;">Category</th>
                      <th style="width: 10%;">Qty</th>
                      <th style="width: 10%;">Unit</th>
                      <th style="width: 15%;">Unit Price</th>
                      <th style="width: 15%;">Total</th>
                      <th style="width: 5%;">Actions</th>
                    </tr>
                  </thead>
                  <tbody id="tableBody"></tbody>
                  <tfoot>
                    <tr>
                      <td colspan="5"><strong>Subtotal</strong></td>
                      <td><strong id="subtotal">$0.00</strong></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td colspan="5"><strong>Tax</strong></td>
                      <td><strong id="tax">$0.00</strong></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td colspan="5"><strong>Contingency</strong></td>
                      <td><strong id="contingencyAmount">$0.00</strong></td>
                      <td></td>
                    </tr>
                    <tr>
                      <td colspan="5"><strong>Grand Total</strong></td>
                      <td><strong id="grandTotal">$0.00</strong></td>
                      <td></td>
                    </tr>
                  </tfoot>
                </table>
              </div>
            </div>
          </div>
        </div>

        <!-- Projects Page -->
        <div id="projectsPage" class="page hidden">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Saved Projects</h3>
              <button class="btn btn-primary" onclick="loadProject()">📂 Load</button>
            </div>
            <div class="card-body">
              <div id="projectsList">
                <p class="text-secondary">No saved projects yet.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Page -->
        <div id="settingsPage" class="page hidden">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Application Settings</h3>
            </div>
            <div class="card-body">
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">Default Tax Rate (%)</label>
                  <input type="number" class="form-input" id="defaultTaxRate" value="8.25">
                </div>
                <div class="form-group">
                  <label class="form-label">Default Contingency (%)</label>
                  <input type="number" class="form-input" id="defaultContingency" value="10">
                </div>
                <div class="form-group">
                  <label class="form-label">Currency Symbol</label>
                  <input type="text" class="form-input" id="currencySymbol" value="$">
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Cloud Sync Page -->
        <div id="syncPage" class="page hidden">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">GitHub Integration</h3>
            </div>
            <div class="card-body">
              <div id="syncStatus" class="stat-card" style="margin-bottom: 1rem;">
                <p>Not connected to GitHub</p>
              </div>
              <div class="form-grid">
                <div class="form-group">
                  <label class="form-label">GitHub Username</label>
                  <input type="text" class="form-input" id="githubUsername">
                </div>
                <div class="form-group">
                  <label class="form-label">Personal Access Token</label>
                  <input type="password" class="form-input" id="githubToken">
                </div>
              </div>
              <button class="btn btn-primary" onclick="connectGitHub()" style="margin-top: 1rem;">
                🔗 Connect GitHub
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Modal Title</h3>
      </div>
      <div id="modalBody"></div>
      <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
        <button class="btn btn-primary" id="modalConfirm">Confirm</button>
        <button class="btn btn-secondary" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // Comprehensive Construction Items Database
    const itemsDB = {
      "Concrete & Masonry": [
        { name: "Concrete (Ready Mix)", unit: "cubic yard", price: 166 },
        { name: "Concrete Installation", unit: "sq ft", price: 10.50 },
        { name: "Concrete Pump Service", unit: "hour", price: 185 },
        { name: "Rebar #4", unit: "linear foot", price: 1.32 },
        { name: "Rebar #5", unit: "linear foot", price: 2.05 },
        { name: "Rebar #6", unit: "linear foot", price: 2.94 },
        { name: "Concrete Block 8\"", unit: "each", price: 2.25 },
        { name: "Mortar Mix", unit: "bag", price: 8.95 },
        { name: "Brick (Standard)", unit: "1000", price: 485 },
        { name: "Stone Veneer", unit: "sq ft", price: 18.75 }
      ],
      "Structural Steel": [
        { name: "Structural Steel Beam", unit: "ton", price: 1650 },
        { name: "Steel Column", unit: "ton", price: 1875 },
        { name: "Metal Decking", unit: "sq ft", price: 3.85 },
        { name: "Steel Studs", unit: "linear foot", price: 2.45 },
        { name: "Welding Labor", unit: "hour", price: 85 }
      ],
      "Lumber & Wood": [
        { name: "Framing Lumber 2x4", unit: "linear foot", price: 1.65 },
        { name: "Framing Lumber 2x6", unit: "linear foot", price: 2.80 },
        { name: "Framing Lumber 2x8", unit: "linear foot", price: 4.25 },
        { name: "Framing Lumber 2x10", unit: "linear foot", price: 6.15 },
        { name: "Framing Lumber 2x12", unit: "linear foot", price: 8.90 },
        { name: "Plywood 1/2\"", unit: "sheet", price: 35 },
        { name: "Plywood 3/4\"", unit: "sheet", price: 52 },
        { name: "OSB Sheathing 7/16\"", unit: "sheet", price: 28 },
        { name: "Engineered I-Joist", unit: "linear foot", price: 4.85 },
        { name: "Glulam Beam", unit: "linear foot", price: 22.50 }
      ],
      "Roofing": [
        { name: "Asphalt Shingles", unit: "sq ft", price: 3.75 },
        { name: "Metal Roofing", unit: "sq ft", price: 8.50 },
        { name: "Clay Tiles", unit: "sq ft", price: 12.00 },
        { name: "EPDM Rubber", unit: "sq ft", price: 5.85 },
        { name: "TPO Membrane", unit: "sq ft", price: 6.25 },
        { name: "Roof Underlayment", unit: "sq ft", price: 0.85 },
        { name: "Ice & Water Shield", unit: "sq ft", price: 1.25 },
        { name: "Ridge Vents", unit: "linear foot", price: 8.50 },
        { name: "Gutters (Aluminum)", unit: "linear foot", price: 12.50 },
        { name: "Downspouts", unit: "each", price: 35 }
      ],
      "Insulation": [
        { name: "Fiberglass Batts R-13", unit: "sq ft", price: 0.85 },
        { name: "Fiberglass Batts R-15", unit: "sq ft", price: 0.95 },
        { name: "Fiberglass Batts R-19", unit: "sq ft", price: 1.15 },
        { name: "Fiberglass Batts R-30", unit: "sq ft", price: 1.45 },
        { name: "Spray Foam (Closed Cell)", unit: "sq ft", price: 1.50 },
        { name: "Spray Foam (Open Cell)", unit: "sq ft", price: 0.95 },
        { name: "Rigid Foam Board 1\"", unit: "sq ft", price: 1.25 },
        { name: "Rigid Foam Board 2\"", unit: "sq ft", price: 2.15 },
        { name: "Blown-in Cellulose", unit: "sq ft", price: 0.75 },
        { name: "Mineral Wool", unit: "sq ft", price: 1.35 }
      ],
      "Drywall & Finishes": [
        { name: "Drywall 1/2\"", unit: "sheet", price: 16.80 },
        { name: "Drywall 5/8\"", unit: "sheet", price: 19.25 },
        { name: "Moisture Resistant Drywall", unit: "sheet", price: 24.50 },
        { name: "Fire-Rated Drywall", unit: "sheet", price: 28.75 },
        { name: "Drywall Tape & Mud", unit: "sq ft", price: 0.45 },
        { name: "Interior Paint", unit: "sq ft", price: 0.85 },
        { name: "Exterior Paint", unit: "sq ft", price: 1.25 },
        { name: "Primer", unit: "gallon", price: 28 },
        { name: "Texture Application", unit: "sq ft", price: 0.65 },
        { name: "Crown Molding", unit: "linear foot", price: 12.50 }
      ],
      "Flooring": [
        { name: "Hardwood Flooring", unit: "sq ft", price: 8.50 },
        { name: "Engineered Wood", unit: "sq ft", price: 6.75 },
        { name: "Luxury Vinyl Plank", unit: "sq ft", price: 4.25 },
        { name: "Ceramic Tile", unit: "sq ft", price: 5.85 },
        { name: "Porcelain Tile", unit: "sq ft", price: 7.25 },
        { name: "Natural Stone", unit: "sq ft", price: 15.50 },
        { name: "Carpet", unit: "sq ft", price: 3.85 },
        { name: "Carpet Pad", unit: "sq ft", price: 0.65 },
        { name: "Vinyl Sheet", unit: "sq ft", price: 2.95 },
        { name: "Polished Concrete", unit: "sq ft", price: 7.50 }
      ],
      "Windows & Doors": [
        { name: "Window (Standard)", unit: "each", price: 485 },
        { name: "Window (Energy Star)", unit: "each", price: 725 },
        { name: "Window (Premium)", unit: "each", price: 1250 },
        { name: "Bay Window", unit: "each", price: 2850 },
        { name: "Skylight", unit: "each", price: 985 },
        { name: "Interior Door (Hollow)", unit: "each", price: 185 },
        { name: "Interior Door (Solid)", unit: "each", price: 325 },
        { name: "Exterior Door (Steel)", unit: "each", price: 685 },
        { name: "Exterior Door (Fiberglass)", unit: "each", price: 875 },
        { name: "French Doors", unit: "pair", price: 2450 },
        { name: "Sliding Patio Door", unit: "each", price: 1850 },
        { name: "Garage Door (16x7)", unit: "each", price: 1650 }
      ],
      "Siding & Exterior": [
        { name: "Vinyl Siding", unit: "sq ft", price: 5.25 },
        { name: "Fiber Cement Siding", unit: "sq ft", price: 8.75 },
        { name: "Wood Siding", unit: "sq ft", price: 7.85 },
        { name: "Aluminum Siding", unit: "sq ft", price: 6.25 },
        { name: "Brick Veneer", unit: "sq ft", price: 15.50 },
        { name: "Stone Veneer", unit: "sq ft", price: 18.75 },
        { name: "Stucco System", unit: "sq ft", price: 9.25 },
        { name: "House Wrap", unit: "sq ft", price: 0.25 },
        { name: "Soffit & Fascia", unit: "linear foot", price: 12.85 }
      ],
      "Plumbing": [
        { name: "Copper Pipe 1/2\"", unit: "linear foot", price: 4.85 },
        { name: "Copper Pipe 3/4\"", unit: "linear foot", price: 6.25 },
        { name: "PEX Pipe", unit: "linear foot", price: 1.85 },
        { name: "PVC Pipe 2\"", unit: "linear foot", price: 3.25 },
        { name: "PVC Pipe 4\"", unit: "linear foot", price: 5.85 },
        { name: "Water Heater (50 gal)", unit: "each", price: 1250 },
        { name: "Tankless Water Heater", unit: "each", price: 2850 },
        { name: "Toilet (Standard)", unit: "each", price: 285 },
        { name: "Toilet (Premium)", unit: "each", price: 585 },
        { name: "Sink (Kitchen)", unit: "each", price: 425 },
        { name: "Sink (Bathroom)", unit: "each", price: 225 },
        { name: "Shower Unit", unit: "each", price: 985 },
        { name: "Bathtub", unit: "each", price: 785 }
      ],
      "Electrical": [
        { name: "Romex Wire 12/2", unit: "linear foot", price: 0.85 },
        { name: "Romex Wire 14/2", unit: "linear foot", price: 0.65 },
        { name: "Conduit 1/2\"", unit: "linear foot", price: 2.15 },
        { name: "Electrical Panel 200A", unit: "each", price: 1850 },
        { name: "Circuit Breaker 20A", unit: "each", price: 45 },
        { name: "Outlet (Standard)", unit: "each", price: 15 },
        { name: "GFCI Outlet", unit: "each", price: 35 },
        { name: "Light Switch", unit: "each", price: 12 },
        { name: "Dimmer Switch", unit: "each", price: 28 },
        { name: "Ceiling Fan", unit: "each", price: 185 },
        { name: "Recessed Light", unit: "each", price: 85 },
        { name: "EV Charger Outlet", unit: "each", price: 850 }
      ],
      "HVAC": [
        { name: "Central AC (3-ton)", unit: "each", price: 4850 },
        { name: "Central AC (5-ton)", unit: "each", price: 6750 },
        { name: "Heat Pump (3-ton)", unit: "each", price: 5250 },
        { name: "Furnace (80% eff)", unit: "each", price: 2850 },
        { name: "Furnace (95% eff)", unit: "each", price: 4250 },
        { name: "Ductwork", unit: "sq ft", price: 12.50 },
        { name: "Mini-Split System", unit: "each", price: 3250 },
        { name: "Thermostat (Smart)", unit: "each", price: 285 },
        { name: "Ventilation Fan", unit: "each", price: 185 }
      ],
      "Labor": [
        { name: "General Laborer", unit: "hour", price: 18.25 },
        { name: "Carpenter (Helper)", unit: "hour", price: 19.75 },
        { name: "Carpenter (Skilled)", unit: "hour", price: 29.50 },
        { name: "Carpenter (Master)", unit: "hour", price: 42.00 },
        { name: "Electrician (Apprentice)", unit: "hour", price: 21.50 },
        { name: "Electrician (Journeyman)", unit: "hour", price: 34.50 },
        { name: "Electrician (Master)", unit: "hour", price: 48.75 },
        { name: "Plumber (Journeyman)", unit: "hour", price: 34.75 },
        { name: "Plumber (Master)", unit: "hour", price: 52.00 },
        { name: "HVAC Technician", unit: "hour", price: 38.50 },
        { name: "Mason", unit: "hour", price: 31.25 },
        { name: "Roofer", unit: "hour", price: 26.50 },
        { name: "Painter", unit: "hour", price: 23.75 },
        { name: "Tile Setter", unit: "hour", price: 28.50 },
        { name: "Drywall Installer", unit: "hour", price: 24.50 },
        { name: "Flooring Installer", unit: "hour", price: 25.75 },
        { name: "Insulation Installer", unit: "hour", price: 22.50 },
        { name: "Concrete Finisher", unit: "hour", price: 28.75 },
        { name: "Foreman", unit: "hour", price: 38.50 },
        { name: "Project Manager", unit: "hour", price: 65.00 }
      ],
      "Equipment": [
        { name: "Excavator (Mini)", unit: "day", price: 285 },
        { name: "Excavator (Mid)", unit: "day", price: 485 },
        { name: "Excavator (Large)", unit: "day", price: 825 },
        { name: "Bulldozer (Small)", unit: "day", price: 465 },
        { name: "Bulldozer (Large)", unit: "day", price: 785 },
        { name: "Backhoe Loader", unit: "day", price: 385 },
        { name: "Skid Steer", unit: "day", price: 245 },
        { name: "Wheel Loader", unit: "day", price: 485 },
        { name: "Crane (25-ton)", unit: "day", price: 650 },
        { name: "Crane (50-ton)", unit: "day", price: 950 },
        { name: "Scissor Lift", unit: "day", price: 185 },
        { name: "Boom Lift", unit: "day", price: 325 },
        { name: "Concrete Mixer", unit: "day", price: 125 },
        { name: "Concrete Pump", unit: "day", price: 1250 },
        { name: "Generator (20kW)", unit: "day", price: 125 },
        { name: "Generator (100kW)", unit: "day", price: 385 },
        { name: "Air Compressor", unit: "day", price: 95 },
        { name: "Scaffolding", unit: "day", price: 85 }
      ],
      "Site Work": [
        { name: "Excavation", unit: "cubic yard", price: 15.50 },
        { name: "Grading", unit: "sq ft", price: 1.25 },
        { name: "Fill Dirt", unit: "cubic yard", price: 28 },
        { name: "Topsoil", unit: "cubic yard", price: 45 },
        { name: "Gravel Base", unit: "ton", price: 38 },
        { name: "Concrete Driveway", unit: "sq ft", price: 8.50 },
        { name: "Asphalt Driveway", unit: "sq ft", price: 5.75 },
        { name: "Retaining Wall", unit: "sq ft", price: 22.50 },
        { name: "French Drain", unit: "linear foot", price: 18.50 },
        { name: "Silt Fence", unit: "linear foot", price: 3.25 }
      ],
      "Landscaping": [
        { name: "Sod Installation", unit: "sq ft", price: 0.85 },
        { name: "Seed & Straw", unit: "sq ft", price: 0.25 },
        { name: "Mulch", unit: "cubic yard", price: 45 },
        { name: "Decorative Rock", unit: "ton", price: 125 },
        { name: "Trees (2\" caliper)", unit: "each", price: 285 },
        { name: "Shrubs (5 gal)", unit: "each", price: 45 },
        { name: "Irrigation System", unit: "sq ft", price: 2.85 },
        { name: "Landscape Lighting", unit: "each", price: 125 },
        { name: "Edging", unit: "linear foot", price: 4.25 }
      ],
      "Kitchen & Bath": [
        { name: "Kitchen Cabinets", unit: "linear foot", price: 185 },
        { name: "Countertop (Laminate)", unit: "sq ft", price: 35 },
        { name: "Countertop (Granite)", unit: "sq ft", price: 85 },
        { name: "Countertop (Quartz)", unit: "sq ft", price: 95 },
        { name: "Backsplash Tile", unit: "sq ft", price: 12.50 },
        { name: "Range Hood", unit: "each", price: 485 },
        { name: "Dishwasher", unit: "each", price: 685 },
        { name: "Refrigerator", unit: "each", price: 1850 },
        { name: "Stove/Range", unit: "each", price: 985 },
        { name: "Microwave", unit: "each", price: 385 },
        { name: "Vanity (48\")", unit: "each", price: 785 },
        { name: "Medicine Cabinet", unit: "each", price: 185 }
      ],
      "Specialty": [
        { name: "Solar Panel", unit: "watt", price: 0.85 },
        { name: "Solar Inverter", unit: "each", price: 1250 },
        { name: "Battery Storage", unit: "kWh", price: 850 },
        { name: "Smart Home Hub", unit: "each", price: 485 },
        { name: "Security System", unit: "each", price: 1250 },
        { name: "Fire Sprinkler", unit: "head", price: 85 },
        { name: "Elevator (Residential)", unit: "each", price: 28500 },
        { name: "Pool (In-ground)", unit: "each", price: 45000 },
        { name: "Hot Tub", unit: "each", price: 8500 },
        { name: "Deck (Composite)", unit: "sq ft", price: 35 },
        { name: "Pergola", unit: "sq ft", price: 45 },
        { name: "Fence (Wood)", unit: "linear foot", price: 28 },
        { name: "Fence (Vinyl)", unit: "linear foot", price: 35 }
      ]
    };

    // State Management
    let currentPage = 'dashboard';
    let projects = {};
    let currentProject = null;
    let chart = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      initializeApp();
    });

    function initializeApp() {
      // Event Listeners
      document.getElementById('darkMode').addEventListener('change', toggleTheme);
      document.getElementById('menuToggle').addEventListener('click', toggleSidebar);
      document.getElementById('saveBtn').addEventListener('click', saveProject);
      
      // Navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          const page = item.getAttribute('data-page');
          switchPage(page);
        });
      });

      // Load saved data
      loadFromStorage();
      
      // Initialize first row
      if (currentPage === 'estimate') {
        addRow();
      }
      
      updateDashboard();
    }

    // Page Navigation
    function switchPage(page) {
      // Update navigation
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === page) {
          item.classList.add('active');
        }
      });

      // Hide all pages
      document.querySelectorAll('.page').forEach(p => {
        p.classList.add('hidden');
      });

      // Show selected page
      const pageElement = document.getElementById(page + 'Page');
      if (pageElement) {
        pageElement.classList.remove('hidden');
      }

      // Update header
      const titles = {
        dashboard: 'Dashboard',
        estimate: 'Cost Estimate',
        projects: 'Projects',
        settings: 'Settings',
        sync: 'Cloud Sync'
      };
      document.getElementById('pageTitle').textContent = titles[page] || 'Dashboard';
      
      currentPage = page;

      // Page-specific actions
      if (page === 'dashboard') {
        updateDashboard();
      } else if (page === 'estimate' && document.getElementById('tableBody').children.length === 0) {
        addRow();
      } else if (page === 'projects') {
        displayProjects();
      }
    }

    // Theme Toggle
    function toggleTheme() {
      const isDark = document.getElementById('darkMode').checked;
      document.body.setAttribute('data-theme', isDark ? 'dark' : 'light');
      saveToStorage();
    }

    // Sidebar Toggle (Mobile)
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('open');
    }

    // Add Row to Estimate Table
    function addRow(data = {}) {
      const tbody = document.getElementById('tableBody');
      const row = document.createElement('tr');
      const rowId = 'row_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
      
      row.innerHTML = `
        <td>
          <div style="position: relative;">
            <input type="text" 
                   class="form-input item-search" 
                   placeholder="Search items..." 
                   value="${data.item || ''}"
                   onkeyup="filterItems(this)"
                   onfocus="showDropdown(this)"
                   onblur="hideDropdown(this)"
                   data-row-id="${rowId}">
            <select class="form-select item-select" 
                    id="select_${rowId}"
                    style="position: absolute; top: 100%; left: 0; right: 0; max-height: 300px; overflow-y: auto; display: none; z-index: 100;"
                    onchange="selectItem(this, '${rowId}')"
                    size="10">
              ${generateOptions()}
            </select>
          </div>
        </td>
        <td class="category">${data.category || ''}</td>
        <td><input type="number" value="${data.quantity || 1}" min="0" step="0.01" onchange="calculateRow(this)"></td>
        <td class="unit">${data.unit || ''}</td>
        <td><input type="number" value="${data.unitPrice || 0}" min="0" step="0.01" onchange="calculateRow(this)"></td>
        <td class="total">$0.00</td>
        <td>
          <button class="btn btn-danger btn-icon" onclick="deleteRow(this)">🗑️</button>
        </td>
      `;
      
      tbody.appendChild(row);
      
      if (data.item) {
        calculateRow(row.querySelector('input[type="number"]'));
      }
    }

    // Generate options for select
    function generateOptions(filter = '') {
      const lowerFilter = filter.toLowerCase();
      let options = '<option value="">-- Select Item --</option>';
      
      Object.entries(itemsDB).forEach(([category, items]) => {
        const filteredItems = items.filter(item => 
          filter === '' || 
          item.name.toLowerCase().includes(lowerFilter) ||
          category.toLowerCase().includes(lowerFilter)
        );
        
        if (filteredItems.length > 0) {
          options += `<optgroup label="${category}">`;
          filteredItems.forEach(item => {
            options += `<option value="${item.name}" 
                               data-unit="${item.unit}" 
                               data-price="${item.price}" 
                               data-category="${category}">
                          ${item.name} (${item.unit} - ${item.price})
                        </option>`;
          });
          options += '</optgroup>';
        }
      });
      
      return options;
    }

    // Filter items in dropdown
    function filterItems(input) {
      const rowId = input.getAttribute('data-row-id');
      const select = document.getElementById('select_' + rowId);
      select.innerHTML = generateOptions(input.value);
      if (input.value.length > 0) {
        select.style.display = 'block';
      }
    }

    // Show dropdown
    function showDropdown(input) {
      const rowId = input.getAttribute('data-row-id');
      const select = document.getElementById('select_' + rowId);
      setTimeout(() => {
        select.style.display = 'block';
      }, 100);
    }

    // Hide dropdown
    function hideDropdown(input) {
      const rowId = input.getAttribute('data-row-id');
      const select = document.getElementById('select_' + rowId);
      setTimeout(() => {
        if (!select.matches(':hover')) {
          select.style.display = 'none';
        }
      }, 200);
    }

    // Select item from dropdown
    function selectItem(select, rowId) {
      const option = select.selectedOptions[0];
      const row = select.closest('tr');
      const input = row.querySelector('.item-search');
      
      if (option && option.value) {
        input.value = option.value;
        row.querySelector('.category').textContent = option.getAttribute('data-category');
        row.querySelector('.unit').textContent = option.getAttribute('data-unit');
        row.querySelector('input[type="number"]:nth-of-type(2)').value = option.getAttribute('data-price');
        
        calculateRow(input);
        select.style.display = 'none';
      }
    }

    // Update Item Selection (modified to work with search)
    function updateItem(element) {
      calculateRow(element);
    }

    // Calculate Row Total
    function calculateRow(element) {
      const row = element.closest('tr');
      const quantity = parseFloat(row.cells[2].querySelector('input').value) || 0;
      const unitPrice = parseFloat(row.cells[4].querySelector('input').value) || 0;
      const total = quantity * unitPrice;
      
      row.querySelector('.total').textContent = `$${total.toFixed(2)}`;
      
      calculateTotals();
    }

    // Calculate All Totals
    function calculateTotals() {
      const rows = document.querySelectorAll('#tableBody tr');
      let subtotal = 0;
      
      rows.forEach(row => {
        const totalText = row.querySelector('.total').textContent;
        subtotal += parseFloat(totalText.replace('$', '')) || 0;
      });
      
      const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
      const contingencyRate = parseFloat(document.getElementById('contingency').value) || 0;
      
      const tax = subtotal * (taxRate / 100);
      const contingency = subtotal * (contingencyRate / 100);
      const grandTotal = subtotal + tax + contingency;
      
      document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
      document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
      document.getElementById('contingencyAmount').textContent = `$${contingency.toFixed(2)}`;
      document.getElementById('grandTotal').textContent = `$${grandTotal.toFixed(2)}`;
    }

    // Delete Row
    function deleteRow(button) {
      if (confirm('Delete this item?')) {
        button.closest('tr').remove();
        calculateTotals();
      }
    }

    // Save Project
    function saveProject() {
      const projectName = document.getElementById('projectName').value || 'Untitled Project';
      const projectId = currentProject || 'project_' + Date.now();
      
      const rows = Array.from(document.querySelectorAll('#tableBody tr')).map(row => ({
        item: row.cells[0].querySelector('select').value,
        category: row.cells[1].textContent,
        quantity: row.cells[2].querySelector('input').value,
        unit: row.cells[3].textContent,
        unitPrice: row.cells[4].querySelector('input').value
      }));
      
      projects[projectId] = {
        id: projectId,
        name: projectName,
        regionFactor: document.getElementById('regionFactor').value,
        taxRate: document.getElementById('taxRate').value,
        contingency: document.getElementById('contingency').value,
        rows: rows,
        timestamp: new Date().toISOString()
      };
      
      currentProject = projectId;
      saveToStorage();
      
      // Show confirmation
      const saveBtn = document.getElementById('saveBtn');
      saveBtn.textContent = '✅ Saved!';
      setTimeout(() => {
        saveBtn.textContent = '💾 Save';
      }, 2000);
    }

    // Load from Storage
    function loadFromStorage() {
      const saved = localStorage.getItem('constructionEstimator');
      if (saved) {
        const data = JSON.parse(saved);
        projects = data.projects || {};
        currentProject = data.currentProject;
        document.getElementById('darkMode').checked = data.darkMode || false;
        toggleTheme();
      }
    }

    // Save to Storage
    function saveToStorage() {
      const data = {
        projects: projects,
        currentProject: currentProject,
        darkMode: document.getElementById('darkMode').checked
      };
      localStorage.setItem('constructionEstimator', JSON.stringify(data));
    }

    // Update Dashboard
    function updateDashboard() {
      const projectCount = Object.keys(projects).length;
      let totalValue = 0;
      let totalItems = 0;
      const categoryTotals = {};
      
      Object.values(projects).forEach(project => {
        project.rows.forEach(row => {
          const total = parseFloat(row.quantity) * parseFloat(row.unitPrice);
          totalValue += total;
          totalItems++;
          
          const category = row.category || 'Other';
          categoryTotals[category] = (categoryTotals[category] || 0) + total;
        });
      });
      
      document.getElementById('totalProjects').textContent = projectCount;
      document.getElementById('totalValue').textContent = `$${totalValue.toFixed(0)}`;
      document.getElementById('avgProject').textContent = projectCount > 0 ? 
        `$${(totalValue / projectCount).toFixed(0)}` : '$0';
      document.getElementById('activeItems').textContent = totalItems;
      
      // Update Chart
      updateChart(categoryTotals);
    }

    // Update Chart
    function updateChart(data) {
      const ctx = document.getElementById('chartCanvas');
      if (!ctx) return;
      
      if (chart) {
        chart.destroy();
      }
      
      const isDark = document.body.getAttribute('data-theme') === 'dark';
      
      chart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(data),
          datasets: [{
            data: Object.values(data),
            backgroundColor: [
              '#3b82f6',
              '#10b981',
              '#f59e0b',
              '#ef4444',
              '#8b5cf6'
            ]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: isDark ? '#f9fafb' : '#111827',
                padding: 15
              }
            }
          }
        }
      });
    }

    // Display Projects
    function displayProjects() {
      const container = document.getElementById('projectsList');
      
      if (Object.keys(projects).length === 0) {
        container.innerHTML = '<p class="text-secondary">No saved projects yet.</p>';
        return;
      }
      
      container.innerHTML = Object.entries(projects).map(([id, project]) => `
        <div class="card" style="margin-bottom: 0.5rem;">
          <div class="card-body" style="padding: 1rem;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <strong>${project.name}</strong>
                <p style="font-size: 0.875rem; color: var(--text-secondary); margin: 0;">
                  ${new Date(project.timestamp).toLocaleDateString()} - ${project.rows.length} items
                </p>
              </div>
              <div style="display: flex; gap: 0.5rem;">
                <button class="btn btn-primary btn-icon" onclick="loadProjectData('${id}')">📂</button>
                <button class="btn btn-danger btn-icon" onclick="deleteProject('${id}')">🗑️</button>
              </div>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Load Project Data
    function loadProjectData(projectId) {
      const project = projects[projectId];
      if (!project) return;
      
      currentProject = projectId;
      
      // Switch to estimate page
      switchPage('estimate');
      
      // Load project data
      document.getElementById('projectName').value = project.name;
      document.getElementById('regionFactor').value = project.regionFactor;
      document.getElementById('taxRate').value = project.taxRate;
      document.getElementById('contingency').value = project.contingency;
      
      // Clear and load rows
      document.getElementById('tableBody').innerHTML = '';
      project.rows.forEach(row => addRow(row));
      
      calculateTotals();
    }

    // Delete Project
    function deleteProject(projectId) {
      if (confirm('Delete this project?')) {
        delete projects[projectId];
        if (currentProject === projectId) {
          currentProject = null;
        }
        saveToStorage();
        displayProjects();
        updateDashboard();
      }
    }

    // Export Data
    function exportData() {
      const data = {
        projects: projects,
        exportDate: new Date().toISOString()
      };
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `construction_estimates_${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }

    // Modal Functions
    function showModal(title, body, onConfirm) {
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('modalBody').innerHTML = body;
      document.getElementById('modalConfirm').onclick = () => {
        onConfirm();
        closeModal();
      };
      document.getElementById('modal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('modal').classList.remove('active');
    }

    // GitHub Connection (Placeholder)
    function connectGitHub() {
      const username = document.getElementById('githubUsername').value;
      const token = document.getElementById('githubToken').value;
      
      if (username && token) {
        document.getElementById('syncStatus').innerHTML = `
          <p class="text-success">✅ Connected to GitHub</p>
          <p style="font-size: 0.875rem;">User: ${username}</p>
        `;
      }
    }
  </script>
</body>
</html>
